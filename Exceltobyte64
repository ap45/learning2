// ExcelConverterUtil.java
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.ss.usermodel.WorkbookFactory;
import org.springframework.util.Base64Utils;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;

public class ExcelConverterUtil {

    public static String excelToBase64(InputStream excelInputStream) throws IOException {
        Workbook workbook = WorkbookFactory.create(excelInputStream);
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        workbook.write(outputStream);
        return Base64Utils.encodeToString(outputStream.toByteArray());
    }

    public static Workbook base64ToExcel(String base64String) throws IOException {
        byte[] decodedBytes = Base64Utils.decodeFromString(base64String);
        return WorkbookFactory.create(new ByteArrayInputStream(decodedBytes));
    }
}


//////////////////////////
// ExcelController.java
import org.apache.poi.ss.usermodel.Workbook;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;

@RestController
public class ExcelController {

    @PostMapping("/excel-to-base64")
    public ResponseEntity<String> excelToBase64(@RequestBody InputStream excelInputStream) throws IOException {
        String base64String = ExcelConverterUtil.excelToBase64(excelInputStream);
        return ResponseEntity.ok(base64String);
    }

    @PostMapping("/base64-to-excel")
    public ResponseEntity<byte[]> base64ToExcel(@RequestBody String base64String) throws IOException {
        Workbook workbook = ExcelConverterUtil.base64ToExcel(base64String);
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        workbook.write(outputStream);

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.parseMediaType("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"));
        headers.add(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=downloaded_excel.xlsx");

        return ResponseEntity.ok()
                .headers(headers)
                .body(outputStream.toByteArray());
    }
}
